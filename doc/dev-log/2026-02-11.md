# 開発日誌: 2026-02-11 (水)

## 今日の概要
プロジェクトの初期セットアップ、基本アーキテクチャの決定、および Docker / uv 環境の構築を中心に行った。また、API クォータ問題が発生したが、プログラムの修正と検証を経て、現在は正常に動作している。

## 実施事項
- **プロジェクト初期化**: `pyproject.toml`, `compose.yaml` (旧 `docker-compose.yml`) の作成。
- **アーキテクチャ設計**: エージェントチーム（Manager, Architect, Coder...）の役割分担を定義。
- **ベースクラスの実装**: `Agent` (基底クラス) および `Manager` クラスの Python 実装。
- **エージェント間連携の実装**: Function Calling (Tools) を使用し、Manager が Architect にタスクを委任 (`delegate_task`) し、結果をタスク分解 (`decompose_task`) する自律的なフローを実現。
- **自動関数呼び出し (Automatic Function Calling)**: Gemini 1.5 の SDK 機能を活用し、再帰的な呼び出しを含むエージェント間の対話を自動化。
- **テスト環境の構築**: `pytest` を導入し、モックを使用した単体テストを実装。
- **CLI 実装**: `typer` と `rich` を使った `main.py` のチャットインターフェースを実装。
- **`Coder` エージェントの実装**: Python コード生成と修正機能。
- **サンドボックススキル (Sandbox Skill) の実装**: 生成されたコードの実行と結果の取得。
- **ドキュメンテーション**:
    - ADR (0001〜0003) の作成。
    - テンプレート (ADR, ポストモーテム) の整備。
    - ディレクトリ構成の整理（`doc/` 配下へ）。

## 発生した課題と解決策
- **API クォータ超過 (429 Error) と無限ループ**:
    - **原因**: 複数のエージェントが連携すると短時間に API リクエストが集中する。また、SDK の自動関数呼び出しを使用すると、リトライ時にチャット履歴が重複し、エージェントが同じツールを無限に呼び出す「ゾンビ・ループ」が発生していた。
    - **解決**: 
        1. **「手動関数呼び出しループ」の導入**: `enable_automatic_function_calling=False` に設定し、エージェント基底クラスで明示的にループと待機（インターバル）を制御。
        2. **リトライプロトコルの洗練**: 指数バックオフを用いたリトライを実装し、失敗したターンの履歴を重複させないように修正。
        3. **モデルの安定運用**: ツール実行を確実に行うため、現在は `gemini-1.5-flash` 系などの FC 安定モデルの使用を前提に調整中。
- **Gemma 3 1B の試行**: クォータ上限が高いため試行したが、モデルが軽量すぎて Function Calling を正しく解釈・実行できないことが判明。
- **Gemini 2.0 / 2.5 の選択**: `gemini-2.5-flash-lite` はクォータに達しやすく、`gemini-2.0-flash` は現在利用上限（limit: 0 等）の制限により試行が困難な状況。

## 明日の予定 / 次のステップ
- `Architect` エージェントの実装。
- Manager から Architect へのタスク委譲ロジックの実装。
- エージェント間通信のプロトコル洗練。

---
*作成者: Antigravity*
