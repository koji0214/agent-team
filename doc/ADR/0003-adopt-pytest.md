# 0003. テストフレームワークとしてpytestを採用

- **ステータス**: 採用 (Accepted)
- **決定日**: 2026-02-11
- **検討者**: User
- **タグ**: testing, python, pytest, unittest

## コンテキスト (Context)

これまでのプロトタイプではPython標準の `unittest` モジュールを使用して単体テストを作成していた。しかし、開発が進むにつれてテストケースが増えることが予想され、より効率的でメンテナンスしやすいテスト環境が求められている。

`unittest` は標準ライブラリであるため追加依存関係が不要というメリットがある一方で、ボイラープレートコードが多くなりがちであり、テスト失敗時の出力が見にくい場合がある。

## 決定 (Decision)

今後の開発において、Pythonの単体テストフレームワークとして **pytest** を採用する。

## 詳細 (Rationale)

### メリット (Pros)

1.  **簡潔な記述**: `self.assertEqual(a, b)` のような冗長なメソッドを使わず、`assert a == b` と書くだけで済む。
2.  **強力なフィクスチャ**: `setUp/tearDown` よりも柔軟で強力なフィクスチャシステムを持ち、テストデータの準備や後処理が容易になる。
3.  **詳細な失敗レポート**: テスト失敗時に変数の値や差分（Diff）が見やすく表示され、デバッグが迅速になる。
4.  **エコシステム**: `pytest-cov` (カバレッジ計測)、`pytest-mock` (モッキング)、`pytest-xdist` (並列実行) など、豊富なプラグインが利用可能。
5.  **既存テストの互換性**: `unittest` スタイルで書かれたテストコードもそのまま実行可能であるため、移行コストが低い。

### デメリット (Cons)

1.  **外部依存**: 標準ライブラリではないため、`pytest` パッケージをインストールする必要がある（開発環境のみ）。

## 移行計画 (Plan)

1.  `pyproject.toml` に `pytest` を開発依存関係として追加する。
2.  既存のテストコード (`unittest.TestCase` ベース) はそのままでも動作するため、急いで書き換える必要はないが、新規作成時は `pytest` スタイルを推奨する。
3.  `.cursorrules` のテストガイドラインを更新する。
