# ADR-0004: LangChain / LangGraph 採用の検討

- **ステータス**: Proposed
- **決定日**: 2026-02-12
- **検討者**: Antigravity
- **タグ**: arch, framework, multi-agent

## コンテキスト (Context)

現在のプロジェクトは、Gemini SDK を直接使用してエージェントの自律的なループ（Manager による指揮、思考の連鎖）をカスタム実装している。
プロジェクトが拡大し、エージェントの数が増えたり、より複雑な状態管理（中断と再開、複雑な条件分岐）が必要になった場合、現在のカスタム実装では保守コストや複雑性が増大する懸念がある。
そのため、エージェント・オーケストレーションに特化したフレームワーク（LangChain / LangGraph）の導入を検討項目の1つとして記録する。

## 検討した代替案 (Alternatives Considered)

- **現行のカスタム実装維持**:
    - **メリット**: 軽量、Gemini SDK の機能を直接制御可能、依存関係が最小限。
    - **デメリット**: 状態管理やエラー回復のロジックを手動で組む必要があり、大規模化に弱い。
- **LangGraph への移行**:
    - **メリット**: エージェント間連携をグラフ構造で定義でき、状態（State）の一貫性が保てる。Checkpoint 機能によるレジュームが可能。
    - **デメリット**: 学習コストが高い。フレームワーク固有の抽象化によりデバッグが難しくなる場合がある。

## 決定 (Decision)

現時点では移行は行わず、**「検討中 (Proposed)」** 状態とする。
フェーズ 5 のフルサイクル検証において、現在のカスタム実装での限界（例：複雑なループでの状態喪失、履歴管理の限界）が顕著になった場合に、LangGraph へのリファクタリングを正式に検討する。

## 詳細とメリット・デメリット (Consequences)

### 恩恵 (Pros)
- フレームワークの標準機能（GitHub連携、Python実行環境等）を容易に取り込める。
- エージェント間の遷移を可視化・管理しやすくなる。
- 長期的なタスクの永続化が容易になる。

### 懸念点・トレードオフ (Cons)
- 既存の `Agent` 基底クラスおよび通信ロジックの大幅な刷新が必要。
- シンプルな CLI アプリケーションとしてはオーバースペックになる可能性がある。

## 備考 (Notes)

- 今後のフルサイクル検証の結果を基に、この ADR のステータスを更新する。
